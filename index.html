<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Anatomia">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  <title>Revis√£o de Anatomia Humana</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            box-sizing: border-box;
        }
        
        .trail-container {
            background: linear-gradient(135deg, #fce7f3 0%, #e0e7ff 50%, #ecfdf5 100%);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            color: #374151;
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .walking-trail {
            position: relative;
            background: linear-gradient(90deg, #8b5cf6 0%, #06b6d4 50%, #10b981 100%);
            border-radius: 20px;
            padding: 40px 20px;
            margin: 30px 0;
            min-height: 200px;
            overflow-x: auto;
            overflow-y: hidden;
        }
        
        .trail-path {
            position: relative;
            display: flex;
            align-items: center;
            min-width: 100%;
            height: 120px;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0px,
                rgba(255,255,255,0.1) 20px,
                transparent 20px,
                transparent 40px
            );
            border-radius: 60px;
            border: 3px dashed rgba(255,255,255,0.3);
        }
        
        .step-marker {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 4px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.5s ease;
            cursor: pointer;
            z-index: 10;
        }
        
        .step-marker.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transform: scale(1.2);
            animation: pulse 2s infinite;
        }
        
        .step-marker.completed {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transform: scale(0.9);
        }
        
        .step-marker.locked {
            background: #6b7280;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(16, 185, 129, 0.8); }
        }
        
        .walking-character {
            position: absolute;
            font-size: 40px;
            transition: all 1s ease-in-out;
            z-index: 20;
            animation: walk 2s infinite;
            top: 40px;
        }
        
        @keyframes walk {
            0%, 100% { transform: translateY(0px) rotate(-5deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }
        
        .trail-progress-line {
            position: absolute;
            top: 50%;
            left: 30px;
            height: 6px;
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
            border-radius: 3px;
            transition: width 1s ease;
            z-index: 5;
        }
        
        .step-tooltip {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .step-marker:hover .step-tooltip {
            opacity: 1;
        }
        
        .footsteps {
            position: absolute;
            top: 70px;
            font-size: 16px;
            color: rgba(255,255,255,0.6);
            animation: fadeFootsteps 3s ease-out forwards;
        }
        
        @keyframes fadeFootsteps {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateX(-50%) translateY(0px); 
                opacity: 0.7;
            }
            50% { 
                transform: translateX(-50%) translateY(-10px); 
                opacity: 1;
            }
        }
        
        .thought-cloud-happy {
            animation: float 2s ease-in-out infinite, glow 2s ease-in-out infinite;
        }
        
        .thought-cloud-thinking {
            animation: float 3s ease-in-out infinite;
            opacity: 0.8;
        }
        
        .thought-cloud-confused {
            animation: float 1.5s ease-in-out infinite, shake 0.5s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3) drop-shadow(0 0 10px rgba(16, 185, 129, 0.5)); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            25% { transform: translateX(-50%) rotate(-2deg); }
            75% { transform: translateX(-50%) rotate(2deg); }
        }
        
        .word-bank {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 24px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .word-chip {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
        }
        
        .word-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .word-chip.selected {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #fbbf24;
            transform: scale(1.05);
        }
        
        .word-chip.used {
            background: #6b7280;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .answer-trail {
            min-height: 80px;
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 3px dashed #cbd5e1;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            position: relative;
        }
        
        .answer-trail.has-words {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .answer-word {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .answer-word:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }
        
        .trail-placeholder {
            color: #64748b;
            font-style: italic;
            text-align: center;
            width: 100%;
            padding: 20px;
        }
        
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            z-index: 1;
            border-radius: 1px;
            animation: drawLine 0.5s ease;
        }
        
        @keyframes drawLine {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .difficulty-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .difficulty-easy { background-color: #10b981; }
        .difficulty-medium { background-color: #f59e0b; }
        .difficulty-hard { background-color: #ef4444; }
        
        .category-badge {
            position: absolute;
            top: 16px;
            left: 16px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .points-badge {
            position: absolute;
            bottom: 16px;
            right: 16px;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px 0;
        }
        
        .card-question {
            font-size: 18px;
            line-height: 1.6;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .card-answer {
            font-size: 16px;
            line-height: 1.6;
            font-weight: 400;
        }
        
        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        
        .game-card.flipped:hover {
            transform: rotateY(180deg) translateY(-8px) scale(1.02);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .correct-answer {
            background-color: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        /* Floating Balls */
        .floating-balls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .ball-float {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.7;
            animation: floatBall 20s infinite linear;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }
        
        .ball-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .ball-green { background: linear-gradient(135deg, #10b981, #059669); }
        .ball-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .ball-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .ball-pink { background: linear-gradient(135deg, #ec4899, #db2777); }
        .ball-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .ball-yellow { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .ball-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .ball-indigo { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .ball-teal { background: linear-gradient(135deg, #14b8a6, #0d9488); }
        .ball-lime { background: linear-gradient(135deg, #84cc16, #65a30d); }
        .ball-violet { background: linear-gradient(135deg, #a855f7, #9333ea); }
        
        @keyframes floatBall {
            0% {
                transform: translateY(100vh) translateX(0px) scale(0.5);
                opacity: 0;
            }
            5% {
                opacity: 0.7;
            }
            50% {
                transform: translateY(50vh) translateX(20px) scale(1);
                opacity: 0.8;
            }
            95% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) translateX(-20px) scale(0.5);
                opacity: 0;
            }
        }
        
        /* Floating Header */
        .floating-header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(14, 165, 233, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 16px 24px;
            color: white;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90vw;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
        }
        
        .header-title-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-icon {
            font-size: 32px;
        }
        
        .floating-header h1 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            line-height: 1.2;
        }
        
        .floating-header h2 {
            font-size: 14px;
            font-weight: 500;
            margin: 0;
            opacity: 0.9;
        }
        
        .compact-stats {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .stat-icon {
            font-size: 16px;
        }
        
        .thought-bubble {
            position: relative;
        }
        
        .thought-bubble #thought-cloud {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            animation: float 3s ease-in-out infinite;
        }
        
        /* Main Game Area */
        .game-main {
            padding-top: 120px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .trail-grid {
            max-width: 1200px;
            width: 100%;
            padding: 20px;
        }
        
        .trail-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .trail-header h3 {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .trail-header p {
            font-size: 16px;
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Scattered Cards Layout */
        .trail-path-container {
            position: relative;
            width: 100%;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            margin: 30px 0;
            overflow: visible;
        }
        
        .trail-path {
            position: relative;
            width: 100%;
            height: 500px;
            background: radial-gradient(
                ellipse at center,
                rgba(255, 182, 193, 0.2) 0%,
                rgba(221, 160, 221, 0.2) 25%,
                rgba(173, 216, 230, 0.2) 50%,
                rgba(144, 238, 144, 0.2) 75%,
                rgba(255, 218, 185, 0.2) 100%
            );
            border-radius: 30px;
            border: 3px dashed rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 0 40px rgba(255, 255, 255, 0.1),
                inset 0 0 40px rgba(255, 255, 255, 0.05);
            overflow: visible;
        }
        
        .trail-house {
            position: absolute;
            width: 80px;
            height: 100px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.15),
                0 0 15px rgba(102, 126, 234, 0.3),
                inset 0 2px 8px rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transform-origin: center;
            animation: float 4s ease-in-out infinite;
            z-index: 5;
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                box-shadow: 
                    0 12px 32px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(102, 126, 234, 0.4),
                    inset 0 2px 10px rgba(255, 255, 255, 0.2);
            }
            50% { 
                transform: translateY(-8px) scale(1.02);
                box-shadow: 
                    0 20px 40px rgba(0, 0, 0, 0.4),
                    0 0 30px rgba(102, 126, 234, 0.6),
                    inset 0 2px 15px rgba(255, 255, 255, 0.3);
            }
        }
        
        .trail-house:hover {
            transform: translateY(-15px) scale(1.15) rotate(5deg);
            box-shadow: 
                0 25px 50px rgba(102, 126, 234, 0.6),
                0 0 40px rgba(255, 255, 255, 0.4),
                inset 0 4px 20px rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.8);
            z-index: 10;
            animation: none;
        }
        
        .trail-house.completed {
            background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);
            box-shadow: 
                0 8px 24px rgba(16, 185, 129, 0.3),
                0 0 20px rgba(16, 185, 129, 0.2),
                inset 0 2px 8px rgba(255, 255, 255, 0.4);
            border-color: rgba(16, 185, 129, 0.8);
            animation: completedPulse 3s ease-in-out infinite;
        }
        
        @keyframes completedPulse {
            0%, 100% { 
                box-shadow: 
                    0 8px 24px rgba(16, 185, 129, 0.3),
                    0 0 20px rgba(16, 185, 129, 0.2),
                    inset 0 2px 8px rgba(255, 255, 255, 0.4);
            }
            50% { 
                box-shadow: 
                    0 12px 32px rgba(16, 185, 129, 0.4),
                    0 0 25px rgba(16, 185, 129, 0.3),
                    inset 0 2px 12px rgba(255, 255, 255, 0.5);
            }
        }
        
        .trail-house.completed:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 
                0 16px 40px rgba(16, 185, 129, 0.4),
                0 0 30px rgba(16, 185, 129, 0.3),
                inset 0 4px 16px rgba(255, 255, 255, 0.6);
            animation: none;
        }
        
        .trail-house.incorrect {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            box-shadow: 
                0 8px 24px rgba(245, 158, 11, 0.3),
                0 0 20px rgba(245, 158, 11, 0.2),
                inset 0 2px 8px rgba(255, 255, 255, 0.4);
            border-color: rgba(245, 158, 11, 0.8);
            animation: incorrectShake 4s ease-in-out infinite;
        }
        
        @keyframes incorrectShake {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-1px) rotate(0.5deg); }
            75% { transform: translateY(-1px) rotate(-0.5deg); }
        }
        
        .trail-house.incorrect:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 
                0 16px 40px rgba(245, 158, 11, 0.4),
                0 0 30px rgba(245, 158, 11, 0.3),
                inset 0 4px 16px rgba(255, 255, 255, 0.6);
            animation: none;
        }
        
        .house-number {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin-bottom: 2px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .house-category {
            font-size: 8px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 4px;
            border-radius: 8px;
            margin-bottom: 2px;
            max-width: 70px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .house-icon {
            font-size: 16px;
        }
        
        .house-status {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Walking Character - Centered in scattered layout */
        .walking-character {
            position: absolute;
            font-size: 36px;
            transition: all 1s ease-in-out;
            z-index: 20;
            animation: walkFloat 3s ease-in-out infinite;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
        }
        
        @keyframes walkFloat {
            0%, 100% { 
                transform: translateY(-50%) scale(1) rotate(0deg);
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
            }
            50% { 
                transform: translateY(-50%) scale(1.1) rotate(5deg);
                filter: drop-shadow(0 0 25px rgba(255, 255, 255, 0.8));
            }
        }
        
        @keyframes victoryGlow {
            0%, 100% { 
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
            }
            50% { 
                filter: drop-shadow(0 0 50px rgba(255, 215, 0, 1));
            }
        }
        
        /* Game Controls */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .shuffle-btn {
            background: rgba(245, 158, 11, 0.9);
            color: white;
        }
        
        .shuffle-btn:hover {
            background: rgba(245, 158, 11, 1);
            transform: translateY(-2px);
        }
        
        .reset-btn {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }
        
        .reset-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: translateY(-2px);
        }
        
        /* Card Modal */
        .card-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .card-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .card-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 80vh;
            max-height: 700px;
            perspective: 1000px;
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 24px;
            color: white;
            backface-visibility: hidden;
            transition: transform 0.6s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .card-container.flipped .card-front {
            transform: rotateY(-180deg);
        }
        
        .card-container.flipped .card-back {
            transform: rotateY(0deg);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .card-category, .card-points {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .card-difficulty {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }
        
        .card-content h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .card-content p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .flip-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: auto;
        }
        
        .flip-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .close-card-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-card-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }
        
        /* Card Game Area */
        .card-game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-game-area h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .card-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        .card-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .clear-btn {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }
        
        .check-btn {
            background: rgba(16, 185, 129, 0.9);
            color: white;
        }
        
        .hint-btn {
            background: rgba(245, 158, 11, 0.9);
            color: white;
        }
        
        .card-btn:hover {
            transform: translateY(-1px);
            opacity: 1;
        }
        
        /* Result Modal */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .result-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .result-content-wrapper {
            position: relative;
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .result-continue-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .result-continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }
        
        /* Mobile-First Responsive Design */
        
        /* Touch-friendly interactions */
        .trail-house, .word-chip, .answer-word, .control-btn, .card-btn, .flip-btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* Prevent zoom on input focus */
        input, textarea, select {
            font-size: 16px;
        }
        
        /* Safe area handling for iOS */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* Base mobile styles (320px+) */
        .floating-header {
            position: fixed;
            top: env(safe-area-inset-top, 10px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(14, 165, 233, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 12px 16px;
            color: white;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: calc(100vw - 20px);
            width: auto;
            min-width: 280px;
        }
        
        /* Mobile trail house adjustments */
        @media (max-width: 767px) {
            .trail-house {
                width: 80px;
                height: 100px;
            }
            
            .trail-path {
                gap: 12px;
                padding: 15px 20px;
                height: 150px;
            }
            
            .trail-path-container {
                min-height: 250px;
                padding: 20px 10px;
            }
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .header-title-section {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }
        
        .header-icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .floating-header h1 {
            font-size: 14px;
            font-weight: 700;
            margin: 0;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .floating-header h2 {
            font-size: 11px;
            font-weight: 500;
            margin: 0;
            opacity: 0.9;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .compact-stats {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            font-size: 11px;
            white-space: nowrap;
        }
        
        .stat-icon {
            font-size: 12px;
        }
        
        .game-main {
            padding-top: calc(env(safe-area-inset-top, 0px) + 80px);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 10px;
            padding-right: 10px;
        }
        
        .trail-grid {
            max-width: 100%;
            width: 100%;
            padding: 10px;
        }
        
        .trail-header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .trail-header h3 {
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 6px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .trail-header p {
            font-size: 13px;
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .trail-path-container {
            position: relative;
            width: 100%;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
            margin: 20px 0;
            overflow: visible;
        }
        
        .trail-path {
            position: relative;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                rgba(16, 185, 129, 0.3) 0deg,
                rgba(59, 130, 246, 0.3) 90deg,
                rgba(245, 158, 11, 0.3) 180deg,
                rgba(239, 68, 68, 0.3) 270deg,
                rgba(16, 185, 129, 0.3) 360deg
            );
            border: 3px dashed rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 0 30px rgba(255, 255, 255, 0.1),
                inset 0 0 30px rgba(255, 255, 255, 0.05);
            animation: rotateTrail 60s linear infinite;
        }
        
        .trail-house {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(102, 126, 234, 0.4),
                inset 0 2px 8px rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transform-origin: center;
            animation: float 4s ease-in-out infinite;
        }
        
        .house-number {
            font-size: 10px;
            font-weight: 700;
            color: white;
            margin-bottom: 1px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .house-category {
            font-size: 5px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 1px 2px;
            border-radius: 4px;
            margin-bottom: 1px;
            max-width: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .house-icon {
            font-size: 8px;
        }
        
        .house-status {
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .walking-character {
            position: absolute;
            font-size: 24px;
            transition: all 1s ease-in-out;
            z-index: 20;
            animation: centerFloat 3s ease-in-out infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .control-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Card Modal Mobile Optimization */
        .card-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 10px;
        }
        
        .card-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: calc(100vh - 20px);
            max-height: calc(100vh - 20px);
            perspective: 1000px;
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 16px;
            color: white;
            backface-visibility: hidden;
            transition: transform 0.6s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .card-category, .card-points {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .card-difficulty {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
        }
        
        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .card-content h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        
        .card-content p {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
            text-align: left;
        }
        
        .flip-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: auto;
            flex-shrink: 0;
            min-height: 44px;
            font-size: 14px;
        }
        
        .close-card-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        /* Word Bank Mobile Optimization */
        .word-bank {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin: 16px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            max-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .word-chip {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .answer-trail {
            min-height: 60px;
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            border: 3px dashed #cbd5e1;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            position: relative;
            max-height: 120px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .answer-word {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 11px;
            min-height: 28px;
            display: flex;
            align-items: center;
        }
        
        .card-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .card-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 36px;
            min-width: 60px;
        }
        
        /* Result Modal Mobile */
        .result-content-wrapper {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 20px;
            max-width: calc(100vw - 20px);
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .result-continue-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: all 0.3s ease;
            min-height: 44px;
            font-size: 14px;
        }
        
        /* Toast Mobile */
        .toast {
            position: fixed;
            top: calc(env(safe-area-inset-top, 0px) + 20px);
            right: 10px;
            left: 10px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-size: 14px;
            text-align: center;
        }
        
        /* Tablet Styles (768px+) */
        @media (min-width: 768px) {
            .floating-header {
                padding: 16px 24px;
                border-radius: 20px;
                max-width: 90vw;
                min-width: 400px;
            }
            
            .header-content {
                gap: 24px;
            }
            
            .header-icon {
                font-size: 32px;
            }
            
            .floating-header h1 {
                font-size: 20px;
            }
            
            .floating-header h2 {
                font-size: 14px;
            }
            
            .compact-stats {
                gap: 16px;
            }
            
            .stat-item {
                font-size: 14px;
            }
            
            .stat-icon {
                font-size: 16px;
            }
            
            .game-main {
                padding-top: calc(env(safe-area-inset-top, 0px) + 120px);
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .trail-grid {
                padding: 20px;
            }
            
            .trail-header {
                margin-bottom: 40px;
                padding: 24px;
                border-radius: 20px;
            }
            
            .trail-header h3 {
                font-size: 24px;
                margin-bottom: 8px;
            }
            
            .trail-header p {
                font-size: 16px;
            }
            
            .trail-path-container {
                height: 500px;
                padding: 40px 20px;
                margin: 30px 0;
            }
            
            .trail-path {
                width: 400px;
                height: 400px;
                border: 4px dashed rgba(255, 255, 255, 0.4);
                box-shadow: 
                    0 0 40px rgba(255, 255, 255, 0.1),
                    inset 0 0 40px rgba(255, 255, 255, 0.05);
            }
            
            .trail-house {
                width: 70px;
                height: 70px;
                border: 4px solid rgba(255, 255, 255, 0.4);
                box-shadow: 
                    0 12px 32px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(102, 126, 234, 0.4),
                    inset 0 2px 10px rgba(255, 255, 255, 0.2);
            }
            
            .house-number {
                font-size: 14px;
                margin-bottom: 2px;
            }
            
            .house-category {
                font-size: 7px;
                padding: 2px 4px;
                border-radius: 6px;
                max-width: 60px;
            }
            
            .house-icon {
                font-size: 12px;
            }
            
            .house-status {
                top: -8px;
                right: -8px;
                font-size: 16px;
                width: 24px;
                height: 24px;
            }
            
            .walking-character {
                font-size: 36px;
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
            }
            
            .control-btn {
                padding: 12px 24px;
                border-radius: 12px;
                font-size: 14px;
            }
            
            .card-container {
                max-width: 600px;
                height: 80vh;
                max-height: 700px;
            }
            
            .card-front, .card-back {
                padding: 24px;
                border-radius: 20px;
            }
            
            .card-header {
                margin-bottom: 20px;
                gap: 8px;
            }
            
            .card-category, .card-points {
                padding: 6px 12px;
                border-radius: 15px;
                font-size: 12px;
            }
            
            .card-difficulty {
                padding: 6px 12px;
                border-radius: 15px;
                font-size: 12px;
            }
            
            .card-content h3 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .card-content p {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 20px;
            }
            
            .flip-btn {
                padding: 12px 24px;
                border-radius: 12px;
                font-size: 16px;
            }
            
            .close-card-btn {
                top: -10px;
                right: -10px;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .word-bank {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 12px;
                margin: 24px 0;
                padding: 20px;
                border-radius: 12px;
                max-height: none;
            }
            
            .word-chip {
                padding: 12px 16px;
                border-radius: 25px;
                font-size: 14px;
                min-height: 44px;
            }
            
            .answer-trail {
                min-height: 80px;
                border-radius: 12px;
                padding: 20px;
                margin: 20px 0;
                gap: 8px;
                max-height: none;
            }
            
            .answer-word {
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 14px;
                min-height: 32px;
            }
            
            .card-controls {
                gap: 12px;
                margin-top: 16px;
            }
            
            .card-btn {
                padding: 8px 16px;
                border-radius: 8px;
                font-size: 12px;
                min-height: 40px;
                min-width: 80px;
            }
            
            .result-content-wrapper {
                padding: 32px;
                border-radius: 20px;
                max-width: 600px;
            }
            
            .result-continue-btn {
                padding: 12px 24px;
                border-radius: 12px;
                margin-top: 20px;
                font-size: 16px;
            }
            
            .toast {
                top: 20px;
                right: 20px;
                left: auto;
                padding: 16px 24px;
                font-size: 16px;
                text-align: left;
            }
        }
        
        /* Desktop Styles (1024px+) */
        @media (min-width: 1024px) {
            .trail-path-container {
                height: 600px;
            }
            
            .trail-path {
                width: 500px;
                height: 500px;
                box-shadow: 
                    0 0 50px rgba(255, 255, 255, 0.1),
                    inset 0 0 50px rgba(255, 255, 255, 0.05);
            }
            
            .trail-house {
                width: 90px;
                height: 90px;
            }
            
            .house-number {
                font-size: 18px;
            }
            
            .house-category {
                font-size: 8px;
                max-width: 70px;
                border-radius: 8px;
            }
            
            .house-icon {
                font-size: 16px;
            }
            
            .walking-character {
                font-size: 48px;
            }
            
            .ball-float {
                width: 8px;
                height: 8px;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 600px) {
            .game-main {
                padding-top: calc(env(safe-area-inset-top, 0px) + 60px);
            }
            
            .floating-header {
                padding: 8px 16px;
            }
            
            .floating-header h1 {
                font-size: 12px;
            }
            
            .floating-header h2 {
                font-size: 10px;
            }
            
            .trail-path-container {
                height: 300px;
            }
            
            .trail-path {
                width: 250px;
                height: 250px;
            }
            
            .trail-house {
                width: 40px;
                height: 40px;
            }
            
            .house-number {
                font-size: 8px;
            }
            
            .house-category {
                font-size: 4px;
                max-width: 30px;
            }
            
            .house-icon {
                font-size: 6px;
            }
            
            .walking-character {
                font-size: 20px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full"><!-- Floating Ball Elements -->
  <div class="floating-balls">
   <div class="ball-float ball-blue" style="top: 10%; left: 5%; animation-delay: 0s;"></div>
   <div class="ball-float ball-green" style="top: 20%; right: 10%; animation-delay: 2s;"></div>
   <div class="ball-float ball-purple" style="top: 60%; left: 8%; animation-delay: 4s;"></div>
   <div class="ball-float ball-orange" style="top: 80%; right: 15%; animation-delay: 6s;"></div>
   <div class="ball-float ball-pink" style="top: 40%; left: 3%; animation-delay: 8s;"></div>
   <div class="ball-float ball-cyan" style="top: 70%; right: 5%; animation-delay: 10s;"></div>
   <div class="ball-float ball-yellow" style="top: 30%; right: 20%; animation-delay: 12s;"></div>
   <div class="ball-float ball-red" style="top: 90%; left: 12%; animation-delay: 14s;"></div>
   <div class="ball-float ball-indigo" style="top: 15%; left: 25%; animation-delay: 16s;"></div>
   <div class="ball-float ball-teal" style="top: 85%; right: 25%; animation-delay: 18s;"></div>
   <div class="ball-float ball-lime" style="top: 45%; right: 8%; animation-delay: 20s;"></div>
   <div class="ball-float ball-violet" style="top: 65%; left: 15%; animation-delay: 22s;"></div>
  </div>
  <div id="app" class="min-h-full" style="background: transparent; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; position: relative; z-index: 10;"><!-- Floating Header -->
   <header class="floating-header">
    <div class="header-content">
     <div class="header-title-section"><span class="header-icon">üî¨</span>
      <div>
       <h1 id="main-title">Revis√£o de Anatomia Humana</h1>
       <h2 id="subtitle">Sistema Nervoso</h2>
      </div>
     </div><!-- Compact Stats -->
     <div class="compact-stats">
      <div class="stat-item"><span class="stat-icon">üî•</span> <span id="current-streak">0</span>
      </div>
      <div class="stat-item"><span class="stat-icon">‚≠ê</span> <span id="max-streak">0</span>
      </div>
      <div class="stat-item"><span class="stat-icon">üö∂‚Äç‚ôÇÔ∏è</span> <span><span id="card-progress">1</span>/<span id="total-cards">35</span></span>
      </div>
      <div class="stat-item thought-bubble"><span>üß†</span>
       <div id="thought-cloud">
        üí≠
       </div>
      </div>
     </div>
    </div>
   </header><!-- Main Game Area -->
   <main class="game-main"><!-- Walking Trail with Hidden Cards -->
    <div class="trail-grid">
     <div class="trail-header">
      <h3>üó∫Ô∏è Jornada pelo Sistema Nervoso</h3>
      <p>Todas as 35 cartas est√£o espalhadas pelo tabuleiro! Explore livremente e clique em qualquer carta para estudar!</p>
     </div><!-- Trail Path Container -->
     <div class="trail-container">
      <div class="trail-path-container">
       <div class="trail-path" id="trail-path"><!-- Walking Character -->
        <div class="walking-character" id="walking-character">
         üö∂‚Äç‚ôÇÔ∏è
        </div><!-- Houses will be generated here -->
       </div>
      </div>
     </div><!-- Game Controls -->
     <div class="game-controls"><button onclick="shuffleCards()" class="control-btn shuffle-btn"> üîÄ Embaralhar </button> <button onclick="resetGame()" class="control-btn reset-btn"> üîÑ Reiniciar </button>
     </div>
    </div><!-- Hidden Card Modal -->
    <div id="card-modal" class="card-modal">
     <div class="card-modal-backdrop" onclick="closeCardModal()"></div>
     <div class="card-container">
      <div class="card-front" id="card-front">
       <div class="card-header"><span id="card-category" class="card-category"></span> <span id="card-difficulty" class="card-difficulty"></span> <span id="card-points" class="card-points"></span>
       </div>
       <div class="card-content">
        <h3 id="card-title">üß† Caso Cl√≠nico</h3>
        <p id="card-question"></p>
       </div><button onclick="flipCard()" class="flip-btn"> üîÑ Virar Carta </button>
      </div>
      <div class="card-back" id="card-back">
       <div class="card-game-area">
        <h3>üéØ Monte sua resposta:</h3><!-- Answer Trail -->
        <div id="answer-trail" class="answer-trail">
         <div class="trail-placeholder">
          Clique nas frases para formar sua resposta...
         </div>
        </div><!-- Word Bank -->
        <div id="word-bank" class="word-bank"><!-- Words will be populated here -->
        </div><!-- Card Controls -->
        <div class="card-controls"><button onclick="clearTrail()" class="card-btn clear-btn"> üóëÔ∏è Limpar </button> <button onclick="checkTrailAnswer()" class="card-btn check-btn"> ‚úÖ Verificar </button> <button onclick="showHint()" class="card-btn hint-btn"> üí° Dica </button>
        </div>
       </div><button onclick="flipCard()" class="flip-btn"> üîÑ Ver Pergunta </button>
      </div><button onclick="closeCardModal()" class="close-card-btn"> ‚úï </button>
     </div>
    </div><!-- Result Modal -->
    <div id="result-modal" class="result-modal">
     <div class="result-modal-backdrop" onclick="closeResultModal()"></div>
     <div class="result-content-wrapper">
      <div id="result-content"></div><button onclick="closeResultModal()" class="result-continue-btn"> Continuar Jornada </button>
     </div>
    </div>
   </main>
  </div>
  <script>
        const defaultConfig = {
            main_title: "Revis√£o de Anatomia Humana",
            subtitle: "Sistema Nervoso",
            professor_name: "",
            institution: "",
            background_color: "#f0f9ff",
            card_color: "#ffffff",
            primary_color: "#0ea5e9",
            text_color: "#1e293b",
            accent_color: "#10b981",
            font_family: "Inter",
            font_size: 16
        };

        const cases = [
            {
                id: "case_1",
                category: "Fun√ß√£o",
                question: "Um bi√≥logo estuda um novo organismo e observa que seu sistema de controle precisa constantemente receber dados ambientais, processar essas informa√ß√µes e coordenar a resposta motora para a sobreviv√™ncia. Com base nestas tr√™s etapas (recep√ß√£o, processamento, resposta), qual a principal analogia que melhor descreve o Sistema Nervoso?",
                correctAnswer: "O Sistema Nervoso funciona como um computador central: recebe inputs (sensores), processa dados (integra√ß√£o) e gera outputs (respostas motoras), coordenando todas as fun√ß√µes do organismo.",
                wordBank: ["Sistema Nervoso funciona", "como computador central", "recebe inputs sensoriais", "processa informa√ß√µes", "gera outputs motores"],
                correctSequence: ["Sistema Nervoso funciona", "como computador central", "recebe inputs sensoriais", "processa informa√ß√µes", "gera outputs motores"],
                difficulty: "F√°cil",
                points: 10
            },
            {
                id: "case_2",
                category: "Homeostase",
                question: "Durante uma febre, o corpo aciona mecanismos para baixar a temperatura. Quais s√£o as tr√™s fun√ß√µes b√°sicas que o Sistema Nervoso executa para manter a homeostase?",
                correctAnswer: "1) Fun√ß√£o Sensorial: detectar a temperatura elevada atrav√©s de termorreceptores; 2) Fun√ß√£o de Integra√ß√£o: processar essa informa√ß√£o no hipot√°lamo; 3) Fun√ß√£o Motora: ativar gl√¢ndulas sudor√≠paras e vasodilata√ß√£o para resfriar o corpo.",
                wordBank: ["Fun√ß√£o Sensorial detecta", "temperatura elevada", "Fun√ß√£o de Integra√ß√£o", "processa no hipot√°lamo", "Fun√ß√£o Motora ativa"],
                correctSequence: ["Fun√ß√£o Sensorial detecta", "temperatura elevada", "Fun√ß√£o de Integra√ß√£o", "processa no hipot√°lamo", "Fun√ß√£o Motora ativa"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_3",
                category: "Divis√£o Anat√¥mica",
                question: "Um pesquisador identifica agrupamentos de corpos celulares dentro da Medula Espinhal (SNC) e fora dela (SNP). Como classificar esses aglomerados anatomicamente?",
                correctAnswer: "No SNC, o agrupamento de corpos celulares √© chamado de N√öCLEO. No SNP, o agrupamento √© chamado de G√ÇNGLIO. Esta distin√ß√£o anat√¥mica √© fundamental para a classifica√ß√£o estrutural do sistema nervoso.",
                wordBank: ["No SNC agrupamento", "√© chamado N√öCLEO", "No SNP agrupamento", "√© chamado G√ÇNGLIO", "distin√ß√£o anat√¥mica fundamental"],
                correctSequence: ["No SNC agrupamento", "√© chamado N√öCLEO", "No SNP agrupamento", "√© chamado G√ÇNGLIO", "distin√ß√£o anat√¥mica fundamental"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_4",
                category: "Histologia",
                question: "Uma amostra de tecido nervoso sob o microsc√≥pio mostra c√©lulas altamente ramificadas capazes de gerar impulsos e, ao redor, c√©lulas que fornecem suporte estrutural e formam barreiras protetoras. Qual c√©lula √© a unidade funcional respons√°vel pela comunica√ß√£o r√°pida (o neur√¥nio) e qual √© o grupo celular respons√°vel pelo seu suporte, nutri√ß√£o e prote√ß√£o (a glia)?",
                correctAnswer: "NEUR√îNIOS: c√©lulas excit√°veis que geram e transmitem impulsos nervosos atrav√©s de seus prolongamentos (dendritos e ax√¥nios). C√âLULAS DA GLIA (ou neur√≥glia): c√©lulas de suporte que nutrem, protegem, isolam e mant√™m a homeostase do tecido nervoso.",
                wordBank: ["NEUR√îNIOS s√£o c√©lulas", "excit√°veis que geram", "e transmitem impulsos", "C√âLULAS DA GLIA", "nutrem e protegem"],
                correctSequence: ["NEUR√îNIOS s√£o c√©lulas", "excit√°veis que geram", "e transmitem impulsos", "C√âLULAS DA GLIA", "nutrem e protegem"],
                difficulty: "F√°cil",
                points: 10
            },
            {
                id: "case_5",
                category: "Demanda Metab√≥lica",
                question: "Um paciente sofre uma hipoglicemia severa (baixo n√≠vel de glicose no sangue). Os primeiros sintomas s√£o confus√£o mental e perda de consci√™ncia. Considerando que o c√©rebro consome 20% do oxig√™nio e glicose do corpo, o que essa alta demanda metab√≥lica sugere sobre a vulnerabilidade do SNC √† interrup√ß√£o no fornecimento de nutrientes?",
                correctAnswer: "O SNC √© extremamente vulner√°vel √† falta de glicose e oxig√™nio devido √† sua alta demanda metab√≥lica. N√£o possui reservas energ√©ticas significativas, dependendo do suprimento sangu√≠neo cont√≠nuo. A hipoglicemia afeta rapidamente a fun√ß√£o cerebral, causando confus√£o e perda de consci√™ncia, pois os neur√¥nios n√£o conseguem manter suas fun√ß√µes vitais sem glicose adequada.",
                wordBank: ["SNC extremamente vulner√°vel", "√† falta de glicose", "alta demanda metab√≥lica", "n√£o possui reservas", "hipoglicemia afeta rapidamente"],
                correctSequence: ["SNC extremamente vulner√°vel", "√† falta de glicose", "alta demanda metab√≥lica", "n√£o possui reservas", "hipoglicemia afeta rapidamente"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_6",
                category: "Anatomia",
                question: "Um sinal el√©trico chega ao corpo de um neur√¥nio motor no Corno Anterior da medula e precisa ser enviado rapidamente ao m√∫sculo. Descreva a fun√ß√£o das estruturas Dendritos e Ax√¥nio na propaga√ß√£o desse impulso nervoso, em termos de dire√ß√£o do sinal (aferente ou eferente) em rela√ß√£o ao corpo celular.",
                correctAnswer: "DENDRITOS: recebem sinais AFERENTES (chegam ao corpo celular) de outros neur√¥nios atrav√©s de sinapses. AX√îNIO: conduz sinais EFERENTES (saem do corpo celular) levando o impulso nervoso do neur√¥nio motor at√© a placa motora no m√∫sculo. O fluxo √©: dendritos ‚Üí corpo celular ‚Üí ax√¥nio ‚Üí terminal sin√°ptico.",
                wordBank: ["DENDRITOS recebem sinais", "AFERENTES chegam ao", "AX√îNIO conduz sinais", "EFERENTES saem do", "impulso at√© m√∫sculo"],
                correctSequence: ["DENDRITOS recebem sinais", "AFERENTES chegam ao", "AX√îNIO conduz sinais", "EFERENTES saem do", "impulso at√© m√∫sculo"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_7",
                category: "Tipologia",
                question: "Um paciente toca em uma superf√≠cie quente. O impulso de dor √© gerado na periferia e levado ao Corno Posterior da medula. Esse sinal √© conduzido por qual tipo de neur√¥nio (motor, sensitivo ou interneur√¥nio)? E qual sua classifica√ß√£o morfol√≥gica mais comum (ex: pseudounipolar), evidenciada pelo corpo celular no g√¢nglio sensitivo?",
                correctAnswer: "NEUR√îNIO SENSITIVO (ou sensorial): conduz informa√ß√µes da periferia para o SNC. Classifica√ß√£o morfol√≥gica: PSEUDOUNIPOLAR - possui um prolongamento √∫nico que se bifurca em dois ramos (um perif√©rico que vai √† pele e outro central que vai √† medula). O corpo celular fica no g√¢nglio da raiz dorsal, fora do SNC.",
                wordBank: ["NEUR√îNIO SENSITIVO conduz", "informa√ß√µes da periferia", "para o SNC", "PSEUDOUNIPOLAR possui", "prolongamento √∫nico bifurcado"],
                correctSequence: ["NEUR√îNIO SENSITIVO conduz", "informa√ß√µes da periferia", "para o SNC", "PSEUDOUNIPOLAR possui", "prolongamento √∫nico bifurcado"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_8",
                category: "Mielina",
                question: "Um impulso nervoso percorre um nervo perif√©rico a uma alta velocidade. Essa velocidade √© creditada √† presen√ßa da bainha de mielina. Qual tipo de c√©lula glial √© respons√°vel por formar a bainha de mielina no SNP (C√©lula de Schwann ou Oligodendr√≥cito) e qual o significado funcional de um ax√¥nio ser mielinizado?",
                correctAnswer: "C√âLULA DE SCHWANN: respons√°vel pela mieliniza√ß√£o no SNP (Sistema Nervoso Perif√©rico). SIGNIFICADO FUNCIONAL: a bainha de mielina atua como isolante el√©trico, permitindo CONDU√á√ÉO SALTAT√ìRIA - o impulso 'pula' de n√≥dulo para n√≥dulo, aumentando drasticamente a velocidade de condu√ß√£o (at√© 120 m/s vs 2 m/s em ax√¥nios n√£o-mielinizados).",
                wordBank: ["C√âLULA DE SCHWANN", "respons√°vel pela mieliniza√ß√£o", "no SNP perif√©rico", "permite CONDU√á√ÉO SALTAT√ìRIA", "aumenta velocidade drasticamente"],
                correctSequence: ["C√âLULA DE SCHWANN", "respons√°vel pela mieliniza√ß√£o", "no SNP perif√©rico", "permite CONDU√á√ÉO SALTAT√ìRIA", "aumenta velocidade drasticamente"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_9",
                category: "Condu√ß√£o",
                question: "A doen√ßa de Guillain-Barr√© causa a desmieliniza√ß√£o dos nervos perif√©ricos. Na condu√ß√£o normal, qual √© o nome do mecanismo pelo qual o potencial de a√ß√£o 'salta' de um N√≥dulo da Bainha de Mielina para o pr√≥ximo, e como a perda dessa mielina afeta a velocidade do sinal?",
                correctAnswer: "CONDU√á√ÉO SALTAT√ìRIA: mecanismo onde o potencial de a√ß√£o 'salta' entre os n√≥dulos de Ranvier (espa√ßos sem mielina). EFEITO DA DESMIELINIZA√á√ÉO: perda da condu√ß√£o saltat√≥ria ‚Üí redu√ß√£o dr√°stica da velocidade ‚Üí condu√ß√£o cont√≠nua lenta ‚Üí sintomas como fraqueza muscular, parestesias e paralisia progressiva na s√≠ndrome de Guillain-Barr√©.",
                wordBank: ["CONDU√á√ÉO SALTAT√ìRIA mecanismo", "potencial salta entre", "n√≥dulos de Ranvier", "desmieliniza√ß√£o reduz velocidade", "causa fraqueza muscular"],
                correctSequence: ["CONDU√á√ÉO SALTAT√ìRIA mecanismo", "potencial salta entre", "n√≥dulos de Ranvier", "desmieliniza√ß√£o reduz velocidade", "causa fraqueza muscular"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_10",
                category: "Sinapse",
                question: "Um neur√¥nio pr√©-sin√°ptico libera Acetilcolina. Esta subst√¢ncia viaja pela Fenda Sin√°ptica e se liga aos receptores p√≥s-sin√°pticos. Qual o nome dessa subst√¢ncia qu√≠mica liberada, e qual a sua a√ß√£o fundamental no neur√¥nio p√≥s-sin√°ptico para desencadear ou inibir a propaga√ß√£o do sinal?",
                correctAnswer: "NEUROTRANSMISSOR: subst√¢ncia qu√≠mica (neste caso, Acetilcolina) liberada pelo neur√¥nio pr√©-sin√°ptico. A√á√ÉO: liga-se a receptores espec√≠ficos na membrana p√≥s-sin√°ptica ‚Üí abre canais i√¥nicos ‚Üí permite entrada/sa√≠da de √≠ons ‚Üí gera potencial p√≥s-sin√°ptico excitat√≥rio (PPSE) ou inibit√≥rio (PPSI) ‚Üí pode desencadear ou inibir novo potencial de a√ß√£o.",
                wordBank: ["NEUROTRANSMISSOR subst√¢ncia qu√≠mica", "liberada pelo neur√¥nio", "liga-se a receptores", "abre canais i√¥nicos", "gera potencial p√≥s-sin√°ptico"],
                correctSequence: ["NEUROTRANSMISSOR subst√¢ncia qu√≠mica", "liberada pelo neur√¥nio", "liga-se a receptores", "abre canais i√¥nicos", "gera potencial p√≥s-sin√°ptico"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_11",
                category: "Meninges/LCS",
                question: "Em um acidente, suspeita-se de hemorragia cerebral. As membranas de prote√ß√£o do SNC est√£o sob risco. Nomeie as tr√™s camadas men√≠ngeas, de fora para dentro, e aponte em qual espa√ßo (ex: subaracn√≥ideo) circula o L√≠quido Cerebrospinal (LCS) que protege o enc√©falo?",
                correctAnswer: "TR√äS MENINGES (de fora para dentro): 1) DURA-M√ÅTER (espessa, resistente); 2) ARACNOIDE-M√ÅTER (m√©dia, aspecto de teia de aranha); 3) PIA-M√ÅTER (delicada, aderida ao tecido nervoso). O L√çQUIDO CEREBROSPINAL (LCS) circula no ESPA√áO SUBARACN√ìIDEO (entre aracnoide e pia-m√°ter), proporcionando prote√ß√£o mec√¢nica e suporte metab√≥lico ao SNC.",
                wordBank: ["DURA-M√ÅTER camada externa", "ARACNOIDE-M√ÅTER camada m√©dia", "PIA-M√ÅTER camada interna", "LCS circula espa√ßo", "SUBARACN√ìIDEO entre camadas"],
                correctSequence: ["DURA-M√ÅTER camada externa", "ARACNOIDE-M√ÅTER camada m√©dia", "PIA-M√ÅTER camada interna", "LCS circula espa√ßo", "SUBARACN√ìIDEO entre camadas"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_12",
                category: "Subst√¢ncia",
                question: "Um neurocirurgi√£o observa um corte no C√≥rtex Cerebral e nota a diferen√ßa de cor. Se a Subst√¢ncia Cinzenta (C√≥rtex) √© composta principalmente por corpos celulares, como podemos descrever a fun√ß√£o dela (processamento) em oposi√ß√£o √† fun√ß√£o da Subst√¢ncia Branca (condu√ß√£o), formada por ax√¥nios mielinizados?",
                correctAnswer: "SUBST√ÇNCIA CINZENTA: composta por corpos celulares neuronais, dendritos e sinapses ‚Üí fun√ß√£o de PROCESSAMENTO e INTEGRA√á√ÉO de informa√ß√µes (an√°lise, tomada de decis√£o, gera√ß√£o de respostas). SUBST√ÇNCIA BRANCA: formada por ax√¥nios mielinizados ‚Üí fun√ß√£o de CONDU√á√ÉO e TRANSMISS√ÉO r√°pida de impulsos entre diferentes regi√µes do SNC. A cinzenta 'pensa', a branca 'conecta'.",
                wordBank: ["SUBST√ÇNCIA CINZENTA composta", "por corpos celulares", "fun√ß√£o de PROCESSAMENTO", "SUBST√ÇNCIA BRANCA formada", "por ax√¥nios mielinizados"],
                correctSequence: ["SUBST√ÇNCIA CINZENTA composta", "por corpos celulares", "fun√ß√£o de PROCESSAMENTO", "SUBST√ÇNCIA BRANCA formada", "por ax√¥nios mielinizados"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_13",
                category: "Telenc√©falo",
                question: "Um paciente com AVC perde a capacidade de coordenar movimentos no lado esquerdo do corpo e apresenta dificuldade de fala (fun√ß√µes do Lobo Frontal). Qual estrutura de subst√¢ncia branca (Corpo Caloso) √© a principal ponte de comunica√ß√£o entre os hemisf√©rios, e qual giro do Lobo L√≠mbico √© crucial para as emo√ß√µes?",
                correctAnswer: "CORPO CALOSO: maior comissura cerebral, formada por fibras de subst√¢ncia branca que conectam os dois hemisf√©rios cerebrais, permitindo comunica√ß√£o e coordena√ß√£o entre eles. GIRO DO C√çNGULO: parte do sistema l√≠mbico, crucial para processamento emocional, mem√≥ria e comportamento. O AVC afetou o hemisf√©rio direito (controla lado esquerdo do corpo) e √°reas de linguagem.",
                wordBank: ["CORPO CALOSO maior", "comissura cerebral conecta", "dois hemisf√©rios cerebrais", "GIRO DO C√çNGULO", "crucial para emo√ß√µes"],
                correctSequence: ["CORPO CALOSO maior", "comissura cerebral conecta", "dois hemisf√©rios cerebrais", "GIRO DO C√çNGULO", "crucial para emo√ß√µes"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_14",
                category: "Aprendizado",
                question: "Ap√≥s um longo per√≠odo de reabilita√ß√£o, um paciente que sofreu um trauma cerebral recupera algumas fun√ß√µes motoras e cognitivas. Qual √© o conceito biol√≥gico que descreve a capacidade do c√©rebro de reorganizar suas vias neurais e sinapses, sendo fundamental para esse processo de recupera√ß√£o e aprendizado?",
                correctAnswer: "NEUROPLASTICIDADE (ou Plasticidade Neural): capacidade do sistema nervoso de modificar suas conex√µes sin√°pticas, formar novas vias neurais e reorganizar circuitos em resposta a experi√™ncias, aprendizado ou les√µes. Permite que √°reas saud√°veis do c√©rebro assumam fun√ß√µes de √°reas lesionadas, sendo fundamental para reabilita√ß√£o e recupera√ß√£o funcional ap√≥s traumas cerebrais.",
                wordBank: ["NEUROPLASTICIDADE capacidade do", "sistema nervoso modificar", "conex√µes sin√°pticas formar", "novas vias neurais", "fundamental para reabilita√ß√£o"],
                correctSequence: ["NEUROPLASTICIDADE capacidade do", "sistema nervoso modificar", "conex√µes sin√°pticas formar", "novas vias neurais", "fundamental para reabilita√ß√£o"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_15",
                category: "Medula Termina√ß√£o",
                question: "Um radiologista analisa a coluna vertebral de um adulto para um procedimento. A medula n√£o se estende at√© o final da coluna. Qual estrutura pontiaguda (Cone Medular) marca o final da Medula Espinhal em adultos (geralmente L1/L2), e qual feixe de ra√≠zes nervosas segue a partir deste ponto?",
                correctAnswer: "CONE MEDULAR (Conus Medullaris): termina√ß√£o pontiaguda da medula espinhal, localizada aproximadamente ao n√≠vel de L1-L2 em adultos. CAUDA EQUINA: conjunto de ra√≠zes nervosas (L2-S5 e cocc√≠geas) que se estendem do cone medular at√© seus respectivos forames intervertebrais, com apar√™ncia semelhante √† cauda de cavalo, da√≠ o nome.",
                wordBank: ["CONE MEDULAR termina√ß√£o", "pontiaguda da medula", "localizada n√≠vel L1-L2", "CAUDA EQUINA conjunto", "de ra√≠zes nervosas"],
                correctSequence: ["CONE MEDULAR termina√ß√£o", "pontiaguda da medula", "localizada n√≠vel L1-L2", "CAUDA EQUINA conjunto", "de ra√≠zes nervosas"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_16",
                category: "Tronco Encef√°lico",
                question: "Um paciente sofre um traumatismo craniano que afeta a base do enc√©falo. Se as fun√ß√µes b√°sicas (respira√ß√£o, frequ√™ncia card√≠aca) forem afetadas, suspeita-se de les√£o no Tronco Encef√°lico. Quais s√£o as tr√™s partes que comp√µem o Tronco Encef√°lico e qual a fun√ß√£o biol√≥gica de comunica√ß√£o entre o c√©rebro e a medula que ele exerce?",
                correctAnswer: "TR√äS PARTES DO TRONCO ENCEF√ÅLICO: 1) MESENC√âFALO (superior); 2) PONTE (m√©dia); 3) BULBO/MEDULA OBLONGA (inferior). FUN√á√ïES: controla fun√ß√µes vitais aut√¥nomas (respira√ß√£o, batimentos card√≠acos, press√£o arterial), serve como via de passagem para tratos ascendentes e descendentes entre c√©rebro e medula espinhal, e cont√©m n√∫cleos de nervos cranianos essenciais.",
                wordBank: ["MESENC√âFALO parte superior", "PONTE parte m√©dia", "BULBO parte inferior", "controla fun√ß√µes vitais", "via passagem c√©rebro-medula"],
                correctSequence: ["MESENC√âFALO parte superior", "PONTE parte m√©dia", "BULBO parte inferior", "controla fun√ß√µes vitais", "via passagem c√©rebro-medula"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_17",
                category: "Pun√ß√£o Lombar",
                question: "Um m√©dico precisa colher L√≠quido Cerebrospinal (LCS) para diagn√≥stico. Considerando o n√≠vel de t√©rmino da Medula Espinhal, por que a regi√£o da Cisterna Lombar √© o local ideal e seguro para a Pun√ß√£o Lombar, minimizando o risco de les√£o medular?",
                correctAnswer: "A Medula Espinhal termina em L1/L2 (Cone Medular). A Cisterna Lombar, localizada abaixo desse n√≠vel, cont√©m apenas LCS e a Cauda Equina, e n√£o a medula espinhal, tornando a pun√ß√£o segura.",
                wordBank: ["Medula Espinhal termina", "em L1/L2 Cone", "Cisterna Lombar localizada", "abaixo desse n√≠vel", "cont√©m apenas LCS"],
                correctSequence: ["Medula Espinhal termina", "em L1/L2 Cone", "Cisterna Lombar localizada", "abaixo desse n√≠vel", "cont√©m apenas LCS"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_18",
                category: "Organiza√ß√£o SNP",
                question: "Um bi√≥logo estuda a inerva√ß√£o de um membro. Ele encontra o 'caminho' (feixes de ax√¥nios) e um 'posto de comando' (aglomerado de corpos celulares) fora do SNC. Como s√£o denominadas as estruturas que carregam feixes de fibras nervosas e os aglomerados de corpos celulares fora do SNC (G√¢nglios)?",
                correctAnswer: "Feixes de fibras nervosas s√£o os Nervos. Aglomerados de corpos celulares fora do SNC s√£o os G√¢nglios.",
                wordBank: ["Feixes de fibras", "nervosas s√£o Nervos", "Aglomerados de corpos", "celulares s√£o G√¢nglios", "fora do SNC"],
                correctSequence: ["Feixes de fibras", "nervosas s√£o Nervos", "Aglomerados de corpos", "celulares s√£o G√¢nglios", "fora do SNC"],
                difficulty: "F√°cil",
                points: 10
            },
            {
                id: "case_19",
                category: "Revestimento Nervo",
                question: "Um nervo espinhal √© surpreendentemente resistente √† tens√£o e compress√£o. Qual √© a camada mais externa e espessa de tecido conjuntivo (epineuro) que circunda e protege todo o nervo, garantindo sua integridade biol√≥gica?",
                correctAnswer: "Epineuro. √â a camada mais externa de tecido conjuntivo que envolve todo o nervo, fornecendo prote√ß√£o mec√¢nica.",
                wordBank: ["Epineuro camada mais", "externa de tecido", "conjuntivo envolve todo", "nervo fornecendo prote√ß√£o", "mec√¢nica contra tens√£o"],
                correctSequence: ["Epineuro camada mais", "externa de tecido", "conjuntivo envolve todo", "nervo fornecendo prote√ß√£o", "mec√¢nica contra tens√£o"],
                difficulty: "F√°cil",
                points: 10
            },
            {
                id: "case_20",
                category: "Subst√¢ncia Medular",
                question: "Em um corte transversal da medula espinhal, a distribui√ß√£o das subst√¢ncias √© oposta √† do c√©rebro. Qual a diferen√ßa na localiza√ß√£o da subst√¢ncia branca e cinzenta, e qual a fun√ß√£o biol√≥gica de cada uma nessa disposi√ß√£o (condu√ß√£o vs. processamento)?",
                correctAnswer: "A Subst√¢ncia Cinzenta est√° no centro (em formato de 'H') (processamento/sinapses). A Subst√¢ncia Branca est√° na periferia (condu√ß√£o de tratos).",
                wordBank: ["Subst√¢ncia Cinzenta est√°", "no centro formato", "H processamento sinapses", "Subst√¢ncia Branca est√°", "na periferia condu√ß√£o"],
                correctSequence: ["Subst√¢ncia Cinzenta est√°", "no centro formato", "H processamento sinapses", "Subst√¢ncia Branca est√°", "na periferia condu√ß√£o"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_21",
                category: "Corno Anterior",
                question: "Um neurologista diagnostica fraqueza muscular devido √† degenera√ß√£o de corpos celulares neuronais no Corno Cinzento Anterior. Qual √© a fun√ß√£o motora que essa regi√£o da medula realiza, e que tipo de neur√¥nios (sensitivos, motores, ou interneur√¥nios) est√£o sendo afetados?",
                correctAnswer: "O Corno Anterior abriga corpos celulares de Neur√¥nios Motores (Eferentes), respons√°veis pelo controle dos m√∫sculos esquel√©ticos (volunt√°rios).",
                wordBank: ["Corno Anterior abriga", "corpos celulares de", "Neur√¥nios Motores Eferentes", "respons√°veis pelo controle", "m√∫sculos esquel√©ticos volunt√°rios"],
                correctSequence: ["Corno Anterior abriga", "corpos celulares de", "Neur√¥nios Motores Eferentes", "respons√°veis pelo controle", "m√∫sculos esquel√©ticos volunt√°rios"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_22",
                category: "Vias Sensitivas",
                question: "A sensa√ß√£o de dor (informa√ß√£o sensitiva) entra na medula pela Raiz Posterior, chegando ao Corno Cinzento Posterior. Qual √© a fun√ß√£o desse corno e qual a estrutura associada √† raiz posterior que cont√©m o corpo celular do neur√¥nio sensitivo?",
                correctAnswer: "O Corno Posterior recebe informa√ß√£o sensitiva (Aferente). O corpo celular do neur√¥nio sensitivo prim√°rio est√° no G√¢nglio Sensitivo do Nervo Espinhal, associado √† Raiz Posterior.",
                wordBank: ["Corno Posterior recebe", "informa√ß√£o sensitiva Aferente", "corpo celular neur√¥nio", "est√° no G√¢nglio", "Sensitivo Raiz Posterior"],
                correctSequence: ["Corno Posterior recebe", "informa√ß√£o sensitiva Aferente", "corpo celular neur√¥nio", "est√° no G√¢nglio", "Sensitivo Raiz Posterior"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_23",
                category: "Meninges Espinhais",
                question: "Durante uma pun√ß√£o para coleta de l√≠quido, o m√©dico precisa atravessar as membranas protetoras da medula. Nomeie as tr√™s meninges espinhais (de fora para dentro) e descreva brevemente a fun√ß√£o do espa√ßo preenchido por LCS em termos de prote√ß√£o mec√¢nica.",
                correctAnswer: "Dura-m√°ter, Aracnoide-m√°ter e Pia-m√°ter. O LCS (L√≠quido Cerebrospinal) no espa√ßo subaracn√≥ideo fornece amortecimento e flutuabilidade (prote√ß√£o contra choque).",
                wordBank: ["Dura-m√°ter Aracnoide-m√°ter", "e Pia-m√°ter", "LCS L√≠quido Cerebrospinal", "espa√ßo subaracn√≥ideo fornece", "amortecimento e flutuabilidade"],
                correctSequence: ["Dura-m√°ter Aracnoide-m√°ter", "e Pia-m√°ter", "LCS L√≠quido Cerebrospinal", "espa√ßo subaracn√≥ideo fornece", "amortecimento e flutuabilidade"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_24",
                category: "Corno Lateral",
                question: "O Corno Cinzento Lateral √© vis√≠vel apenas em algumas regi√µes da medula (T1 a L2). Qual sistema funcional do corpo (Aut√¥nomo ou Som√°tico) ele abriga, e qual √© a sua principal fun√ß√£o em termos de regula√ß√£o visceral?",
                correctAnswer: "Abriga corpos celulares de neur√¥nios pr√©-ganglionares do Sistema Nervoso Aut√¥nomo Simp√°tico. Sua fun√ß√£o √© controlar as fun√ß√µes viscerais (involunt√°rias) como o batimento card√≠aco, vasos sangu√≠neos e gl√¢ndulas.",
                wordBank: ["Abriga corpos celulares", "neur√¥nios pr√©-ganglionares", "Sistema Nervoso Aut√¥nomo", "Simp√°tico controlar fun√ß√µes", "viscerais involunt√°rias card√≠aco"],
                correctSequence: ["Abriga corpos celulares", "neur√¥nios pr√©-ganglionares", "Sistema Nervoso Aut√¥nomo", "Simp√°tico controlar fun√ß√µes", "viscerais involunt√°rias card√≠aco"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_25",
                category: "Curiosidade Dor",
                question: "Durante uma cirurgia cerebral, o paciente pode estar acordado, sem sentir dor no tecido cerebral em si. O que falta no tecido cerebral (nociceptores) que est√° presente nas meninges e na pele que explica por que o c√©rebro, centro de processamento de dor, n√£o sente dor?",
                correctAnswer: "O tecido cerebral (par√™nquima) n√£o possui Nociceptores (receptores de dor). A dor √© sentida pelas meninges e vasos sangu√≠neos adjacentes.",
                wordBank: ["tecido cerebral par√™nquima", "n√£o possui Nociceptores", "receptores de dor", "dor sentida pelas", "meninges e vasos"],
                correctSequence: ["tecido cerebral par√™nquima", "n√£o possui Nociceptores", "receptores de dor", "dor sentida pelas", "meninges e vasos"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_26",
                category: "Esclerose M√∫ltipla",
                question: "A Esclerose M√∫ltipla √© uma doen√ßa autoimune onde a bainha de mielina no SNC √© destru√≠da. Biologicamente, como a destrui√ß√£o dessa camada lipoproteica afeta a velocidade e a efici√™ncia da transmiss√£o do impulso nervoso, e quais s√£o as consequ√™ncias cl√≠nicas para o paciente?",
                correctAnswer: "A destrui√ß√£o impede a Condu√ß√£o Saltat√≥ria, diminuindo drasticamente a velocidade de transmiss√£o ou bloqueando-a, resultando em sintomas motores (fraqueza) e sensitivos.",
                wordBank: ["destrui√ß√£o impede Condu√ß√£o", "Saltat√≥ria diminuindo velocidade", "transmiss√£o ou bloqueando", "resultando sintomas motores", "fraqueza e sensitivos"],
                correctSequence: ["destrui√ß√£o impede Condu√ß√£o", "Saltat√≥ria diminuindo velocidade", "transmiss√£o ou bloqueando", "resultando sintomas motores", "fraqueza e sensitivos"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_27",
                category: "Dienc√©falo/L√≠mbico",
                question: "Um paciente com amn√©sia grave √© incapaz de formar novas mem√≥rias duradouras, indicando les√£o no sistema l√≠mbico (Hipocampo, ligado ao Giro Parahipocampal). Qual estrutura do Dienc√©falo (Hipot√°lamo) regula fun√ß√µes viscerais (fome, sede, temperatura), e qual a import√¢ncia biol√≥gica do Hipocampo para a consolida√ß√£o de novas mem√≥rias?",
                correctAnswer: "Hipot√°lamo (regula√ß√£o visceral). Hipocampo (ligado ao Giro Parahipocampal) √© fundamental para a convers√£o de mem√≥rias de curto prazo em longo prazo.",
                wordBank: ["Hipot√°lamo regula√ß√£o visceral", "Hipocampo ligado Giro", "Parahipocampal fundamental para", "convers√£o mem√≥rias curto", "prazo em longo"],
                correctSequence: ["Hipot√°lamo regula√ß√£o visceral", "Hipocampo ligado Giro", "Parahipocampal fundamental para", "convers√£o mem√≥rias curto", "prazo em longo"],
                difficulty: "Dif√≠cil",
                points: 20
            },
            {
                id: "case_28",
                category: "Ra√≠zes Nervosas",
                question: "Uma les√£o por compress√£o na coluna afeta a capacidade motora e sensitiva. Quais s√£o as duas Ra√≠zes Nervosas (anterior e posterior) que se unem para formar o Nervo Espinhal, e qual delas cont√©m o G√¢nglio Sensitivo (aglomerado de corpos celulares sensitivos)?",
                correctAnswer: "Raiz Anterior (Motora/Eferente) e Raiz Posterior (Sensitiva/Aferente). O G√¢nglio Sensitivo est√° na Raiz Posterior.",
                wordBank: ["Raiz Anterior Motora", "Eferente Raiz Posterior", "Sensitiva Aferente G√¢nglio", "Sensitivo est√° na", "Raiz Posterior"],
                correctSequence: ["Raiz Anterior Motora", "Eferente Raiz Posterior", "Sensitiva Aferente G√¢nglio", "Sensitivo est√° na", "Raiz Posterior"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_29",
                category: "T√°lamo/Hip√≥fise",
                question: "Um neurocientista descreve o T√°lamo como uma esta√ß√£o de revezamento. Qual estrutura do Dienc√©falo atua como 'port√£o de entrada' para a maioria das informa√ß√µes sensoriais que chegam ao C√≥rtex Cerebral, e qual gl√¢ndula end√≥crina fundamental se liga anatomicamente ao Hipot√°lamo?",
                correctAnswer: "T√°lamo (revezamento sensorial). Hip√≥fise (Pituit√°ria) (gl√¢ndula end√≥crina).",
                wordBank: ["T√°lamo revezamento sensorial", "port√£o entrada informa√ß√µes", "sensoriais C√≥rtex Cerebral", "Hip√≥fise Pituit√°ria gl√¢ndula", "end√≥crina liga Hipot√°lamo"],
                correctSequence: ["T√°lamo revezamento sensorial", "port√£o entrada informa√ß√µes", "sensoriais C√≥rtex Cerebral", "Hip√≥fise Pituit√°ria gl√¢ndula", "end√≥crina liga Hipot√°lamo"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_30",
                category: "Cerebelo",
                question: "Ao fazer um corte sagital no Cerebelo, a subst√¢ncia branca apresenta um padr√£o arborizado. Qual o nome dado a essa organiza√ß√£o, e qual sua import√¢ncia em termos de condu√ß√£o de sinais entre o c√≥rtex cerebelar (cinzenta) e os n√∫cleos profundos?",
                correctAnswer: "√Årvore da Vida (Arbor Vitae). √â a via de condu√ß√£o de e para o c√≥rtex cerebelar, essencial para a coordena√ß√£o motora.",
                wordBank: ["√Årvore da Vida", "Arbor Vitae via", "condu√ß√£o c√≥rtex cerebelar", "n√∫cleos profundos essencial", "coordena√ß√£o motora"],
                correctSequence: ["√Årvore da Vida", "Arbor Vitae via", "condu√ß√£o c√≥rtex cerebelar", "n√∫cleos profundos essencial", "coordena√ß√£o motora"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_31",
                category: "Divis√£o Funcional",
                question: "Um bi√≥logo estuda o sistema nervoso e percebe que ele pode ser dividido em termos de controle. Qual √© a principal divis√£o funcional que separa as a√ß√µes conscientes (m√∫sculo esquel√©tico) das a√ß√µes viscerais inconscientes (cora√ß√£o, gl√¢ndulas)?",
                correctAnswer: "O Sistema Nervoso Som√°tico (SNS) controla a√ß√µes conscientes, e o Sistema Nervoso Aut√¥nomo (SNA) controla as a√ß√µes viscerais inconscientes.",
                wordBank: ["Sistema Nervoso Som√°tico", "SNS controla a√ß√µes", "conscientes m√∫sculo esquel√©tico", "Sistema Nervoso Aut√¥nomo", "SNA controla viscerais"],
                correctSequence: ["Sistema Nervoso Som√°tico", "SNS controla a√ß√µes", "conscientes m√∫sculo esquel√©tico", "Sistema Nervoso Aut√¥nomo", "SNA controla viscerais"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_32",
                category: "Partes do Enc√©falo",
                question: "Um neurologista realiza uma resson√¢ncia magn√©tica e precisa descrever as principais estruturas do Enc√©falo. Nomeie as tr√™s principais partes do Enc√©falo, sendo o Telenc√©falo e o Dienc√©falo as estruturas mais superiores.",
                correctAnswer: "As tr√™s partes principais s√£o o C√©rebro (que inclui Telenc√©falo e Dienc√©falo), o Cerebelo e o Tronco Encef√°lico.",
                wordBank: ["tr√™s partes principais", "C√©rebro inclui Telenc√©falo", "e Dienc√©falo", "Cerebelo e Tronco", "Encef√°lico estruturas superiores"],
                correctSequence: ["tr√™s partes principais", "C√©rebro inclui Telenc√©falo", "e Dienc√©falo", "Cerebelo e Tronco", "Encef√°lico estruturas superiores"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_33",
                category: "Racioc√≠nio e Movimento",
                question: "Um paciente sofre uma les√£o traum√°tica na por√ß√£o anterior do c√©rebro, resultando em dificuldade de planejamento de tarefas e no controle dos movimentos volunt√°rios. Qual Lobo Cerebral foi afetado, sendo ele o centro do racioc√≠nio complexo (fun√ß√µes executivas)?",
                correctAnswer: "Lobo Frontal. Ele √© o centro das fun√ß√µes executivas (planejamento, racioc√≠nio) e do controle motor volunt√°rio (Giro Pr√©-Central).",
                wordBank: ["Lobo Frontal centro", "fun√ß√µes executivas planejamento", "racioc√≠nio controle motor", "volunt√°rio Giro Pr√©-Central", "por√ß√£o anterior c√©rebro"],
                correctSequence: ["Lobo Frontal centro", "fun√ß√µes executivas planejamento", "racioc√≠nio controle motor", "volunt√°rio Giro Pr√©-Central", "por√ß√£o anterior c√©rebro"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_34",
                category: "Sensa√ß√£o e Orienta√ß√£o",
                question: "Um indiv√≠duo perde a capacidade de reconhecer objetos pelo tato e tem dificuldade em se orientar no espa√ßo. Qual Lobo Cerebral √© o principal respons√°vel por processar a sensibilidade som√°tica (tato, dor, temperatura, press√£o) e a consci√™ncia espacial?",
                correctAnswer: "Lobo Parietal. Ele processa a sensibilidade som√°tica (Giro P√≥s-Central) e a orienta√ß√£o espacial.",
                wordBank: ["Lobo Parietal processa", "sensibilidade som√°tica tato", "dor temperatura press√£o", "Giro P√≥s-Central orienta√ß√£o", "espacial consci√™ncia espacial"],
                correctSequence: ["Lobo Parietal processa", "sensibilidade som√°tica tato", "dor temperatura press√£o", "Giro P√≥s-Central orienta√ß√£o", "espacial consci√™ncia espacial"],
                difficulty: "M√©dio",
                points: 15
            },
            {
                id: "case_35",
                category: "Emo√ß√µes e Mem√≥ria",
                question: "Em um estudo de caso sobre o sistema l√≠mbico, estruturas como o Hipocampo e o Giro do C√≠ngulo s√£o cruciais. Qual √© a principal fun√ß√£o do Giro do C√≠ngulo nessa √°rea do c√©rebro, em termos de processamento afetivo?",
                correctAnswer: "O Giro do C√≠ngulo √© uma parte central do sistema l√≠mbico e est√° envolvido no processamento de emo√ß√µes, comportamento e regula√ß√£o da dor.",
                wordBank: ["Giro do C√≠ngulo", "parte central sistema", "l√≠mbico processamento emo√ß√µes", "comportamento regula√ß√£o dor", "processamento afetivo crucial"],
                correctSequence: ["Giro do C√≠ngulo", "parte central sistema", "l√≠mbico processamento emo√ß√µes", "comportamento regula√ß√£o dor", "processamento afetivo crucial"],
                difficulty: "M√©dio",
                points: 15
            }
        ];

        let userAnswers = new Map();
        let currentRecordCount = 0;
        let currentCaseIndex = 0;
        let streak = 0;
        let maxStreak = 0;
        let shuffledCases = [...cases];
        let selectedWords = [];
        let usedWords = new Set();
        let hintsUsed = 0;

        let thoughtCloudState = 'thinking'; // 'thinking', 'happy', 'confused'

        const dataHandler = {
            onDataChanged(data) {
                userAnswers.clear();
                data.forEach(record => {
                    userAnswers.set(record.case_id, {
                        answer: record.user_answer,
                        isCorrect: record.is_correct,
                        backendId: record.__backendId
                    });
                });
                currentRecordCount = data.length;
                updateStats();
                renderGame();
            }
        };

        async function init() {
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                console.error("Failed to initialize data SDK");
            }
        }

        function updateStats() {
            document.getElementById('current-streak').textContent = streak;
            document.getElementById('max-streak').textContent = maxStreak;
            document.getElementById('card-progress').textContent = currentCaseIndex + 1;
            document.getElementById('total-cards').textContent = shuffledCases.length;
            updateThoughtCloud();
            updateWalkingCharacterPosition();
        }
        
        function updateThoughtCloud() {
            const cloud = document.getElementById('thought-cloud');
            
            // Remove existing classes
            cloud.className = '';
            
            // Set new state based on performance
            if (streak >= 3) {
                thoughtCloudState = 'happy';
                cloud.className = 'thought-cloud-happy';
                cloud.textContent = 'üåü';
            } else if (streak === 0 && maxStreak > 0) {
                thoughtCloudState = 'confused';
                cloud.className = 'thought-cloud-confused';
                cloud.textContent = 'üòµ';
            } else {
                thoughtCloudState = 'thinking';
                cloud.className = 'thought-cloud-thinking';
                cloud.textContent = 'üí≠';
            }
        }



        function createTrailHouses() {
            const trailPath = document.getElementById('trail-path');
            const walkingCharacter = document.getElementById('walking-character');
            const totalCases = shuffledCases.length;
            
            // Clear existing houses (keep walking character)
            const houses = trailPath.querySelectorAll('.trail-house');
            houses.forEach(house => house.remove());
            
            // Generate scattered positions for all cards
            const positions = generateScatteredPositions(totalCases, trailPath);
            
            // Create house for each case in scattered layout - all visible
            for (let i = 0; i < totalCases; i++) {
                const currentCase = shuffledCases[i];
                const house = document.createElement('div');
                house.className = 'trail-house';
                house.id = `house-${i}`;
                
                // Position the house at scattered coordinates
                const position = positions[i];
                house.style.left = `${position.x}px`;
                house.style.top = `${position.y}px`;
                
                // Add staggered animation delay for floating effect
                house.style.animationDelay = `${i * 0.1}s`;
                
                // Check if this case has been answered
                const hasAnswer = userAnswers.has(currentCase.id);
                let statusIcon = '';
                
                if (hasAnswer) {
                    const answer = userAnswers.get(currentCase.id);
                    if (answer.isCorrect) {
                        house.classList.add('completed');
                        statusIcon = '<div class="house-status">‚úÖ</div>';
                    } else {
                        house.classList.add('incorrect');
                        statusIcon = '<div class="house-status">‚ùå</div>';
                    }
                } else {
                    // Show available status for unanswered cards
                    statusIcon = '<div class="house-status">üìö</div>';
                }
                
                // Get category icon
                const categoryIcons = {
                    'Fun√ß√£o': '‚ö°',
                    'Homeostase': 'üå°Ô∏è',
                    'Divis√£o Anat√¥mica': 'üèóÔ∏è',
                    'Histologia': 'üî¨',
                    'Demanda Metab√≥lica': '‚ö°',
                    'Anatomia': 'üß†',
                    'Tipologia': 'üîç',
                    'Mielina': 'üõ°Ô∏è',
                    'Condu√ß√£o': '‚ö°',
                    'Sinapse': 'üîó',
                    'Meninges/LCS': 'üõ°Ô∏è',
                    'Subst√¢ncia': 'üß™',
                    'Telenc√©falo': 'üß†',
                    'Aprendizado': 'üìö',
                    'Medula Termina√ß√£o': 'ü¶¥',
                    'Tronco Encef√°lico': 'üß†',
                    'Pun√ß√£o Lombar': 'üíâ',
                    'Organiza√ß√£o SNP': 'üîó',
                    'Revestimento Nervo': 'üõ°Ô∏è',
                    'Subst√¢ncia Medular': 'üß™',
                    'Corno Anterior': 'üí™',
                    'Vias Sensitivas': 'üëã',
                    'Meninges Espinhais': 'üõ°Ô∏è',
                    'Corno Lateral': 'üîÑ',
                    'Curiosidade Dor': 'ü§î',
                    'Esclerose M√∫ltipla': '‚ö†Ô∏è',
                    'Dienc√©falo/L√≠mbico': 'üß†',
                    'Ra√≠zes Nervosas': 'üåø',
                    'T√°lamo/Hip√≥fise': 'üéõÔ∏è',
                    'Cerebelo': 'üå≥',
                    'Divis√£o Funcional': 'üéØ',
                    'Partes do Enc√©falo': 'üèõÔ∏è',
                    'Racioc√≠nio e Movimento': 'üé≠',
                    'Sensa√ß√£o e Orienta√ß√£o': 'üó∫Ô∏è',
                    'Emo√ß√µes e Mem√≥ria': 'üíù'
                };
                
                house.innerHTML = `
                    ${statusIcon}
                    <div class="house-number">${i + 1}</div>
                    <div class="house-category">${currentCase.category}</div>
                    <div class="house-icon">${categoryIcons[currentCase.category] || 'üß†'}</div>
                `;
                
                // Add click handler with touch feedback
                house.onclick = () => {
                    // Move character to selected house
                    moveCharacterToHouse(i);
                    // Add visual feedback for touch
                    house.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        house.style.transform = '';
                        openCard(i);
                    }, 150);
                };
                
                trailPath.appendChild(house);
            }
            
            // Update walking character position
            updateWalkingCharacterPosition();
        }
        
        function generateScatteredPositions(count, container) {
            const positions = [];
            const containerWidth = 800; // Approximate container width
            const containerHeight = 400; // Approximate container height
            const cardWidth = 80;
            const cardHeight = 100;
            const minDistance = 120; // Minimum distance between cards
            const maxAttempts = 100; // Maximum attempts to place each card
            
            for (let i = 0; i < count; i++) {
                let position;
                let attempts = 0;
                let validPosition = false;
                
                while (!validPosition && attempts < maxAttempts) {
                    // Generate random position with margins
                    const x = Math.random() * (containerWidth - cardWidth - 40) + 20;
                    const y = Math.random() * (containerHeight - cardHeight - 40) + 20;
                    
                    position = { x, y };
                    
                    // Check if position is far enough from existing positions
                    validPosition = true;
                    for (const existingPos of positions) {
                        const distance = Math.sqrt(
                            Math.pow(position.x - existingPos.x, 2) + 
                            Math.pow(position.y - existingPos.y, 2)
                        );
                        
                        if (distance < minDistance) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    attempts++;
                }
                
                // If we couldn't find a valid position, use a grid fallback
                if (!validPosition) {
                    const cols = Math.ceil(Math.sqrt(count));
                    const row = Math.floor(i / cols);
                    const col = i % cols;
                    position = {
                        x: (col * (containerWidth / cols)) + 20,
                        y: (row * (containerHeight / Math.ceil(count / cols))) + 20
                    };
                }
                
                positions.push(position);
            }
            
            return positions;
        }
        
        function updateWalkingCharacterPosition() {
            const walkingCharacter = document.getElementById('walking-character');
            const completedCount = Array.from(userAnswers.values()).filter(answer => answer.isCorrect).length;
            const totalCases = shuffledCases.length;
            
            // Update character expression and animation based on progress
            const progressPercent = Math.min(completedCount / totalCases, 1);
            
            if (progressPercent >= 1.0) {
                walkingCharacter.textContent = 'üéì'; // Graduated when all done
                walkingCharacter.style.animation = 'walkFloat 2s ease-in-out infinite, victoryGlow 1s ease-in-out infinite';
            } else if (progressPercent >= 0.8) {
                walkingCharacter.textContent = 'ü§ì'; // Smart when almost done
                walkingCharacter.style.animation = 'walkFloat 2.5s ease-in-out infinite';
            } else if (progressPercent >= 0.5) {
                walkingCharacter.textContent = 'üß†'; // Brain when halfway
                walkingCharacter.style.animation = 'walkFloat 3s ease-in-out infinite';
            } else if (progressPercent >= 0.2) {
                walkingCharacter.textContent = 'ü§î'; // Thinking when starting
                walkingCharacter.style.animation = 'walkFloat 3.5s ease-in-out infinite';
            } else {
                walkingCharacter.textContent = 'üö∂‚Äç‚ôÇÔ∏è'; // Walking at start
                walkingCharacter.style.animation = 'walkFloat 4s ease-in-out infinite';
            }
        }

        function moveCharacterToHouse(houseIndex) {
            const walkingCharacter = document.getElementById('walking-character');
            const targetHouse = document.getElementById(`house-${houseIndex}`);
            
            if (!targetHouse) return;
            
            // Get house position from its style (since it's absolutely positioned)
            const houseLeft = parseFloat(targetHouse.style.left) || 0;
            const houseTop = parseFloat(targetHouse.style.top) || 0;
            
            // Center character on the house
            const characterLeft = houseLeft + 40 - 18; // House width/2 - character width/2
            const characterTop = houseTop + 50 - 18; // House height/2 - character height/2
            
            // Animate character movement
            walkingCharacter.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            walkingCharacter.style.left = `${characterLeft}px`;
            walkingCharacter.style.top = `${characterTop}px`;
            walkingCharacter.style.transform = 'scale(1.2)';
            
            // Add walking animation during movement
            walkingCharacter.style.animation = 'none';
            setTimeout(() => {
                walkingCharacter.style.animation = 'walkFloat 0.5s ease-in-out infinite';
            }, 100);
            
            // Reset after movement
            setTimeout(() => {
                walkingCharacter.style.transform = 'scale(1)';
                walkingCharacter.style.transition = '';
                // Return to center after a delay
                setTimeout(() => {
                    walkingCharacter.style.transition = 'all 1s ease-in-out';
                    walkingCharacter.style.left = '50%';
                    walkingCharacter.style.top = '50%';
                    walkingCharacter.style.transform = 'translate(-50%, -50%)';
                    setTimeout(() => {
                        walkingCharacter.style.transition = '';
                        updateWalkingCharacterPosition();
                    }, 1000);
                }, 1000);
            }, 800);
        }

        function openCard(caseIndex) {
            currentCaseIndex = caseIndex;
            const currentCase = shuffledCases[currentCaseIndex];
            
            // Update card content
            document.getElementById('card-category').textContent = currentCase.category;
            document.getElementById('card-difficulty').textContent = currentCase.difficulty;
            document.getElementById('card-points').textContent = `${currentCase.points} pts`;
            document.getElementById('card-title').textContent = `üß† Caso Cl√≠nico ${currentCaseIndex + 1}`;
            document.getElementById('card-question').textContent = currentCase.question;

            // Set difficulty color
            const difficultyElement = document.getElementById('card-difficulty');
            const difficultyColors = {
                'F√°cil': '#10b981',
                'M√©dio': '#f59e0b', 
                'Dif√≠cil': '#ef4444'
            };
            difficultyElement.style.backgroundColor = difficultyColors[currentCase.difficulty] || '#6b7280';

            // Reset card state
            document.getElementById('card-modal').style.display = 'flex';
            document.querySelector('.card-container').classList.remove('flipped');
            
            // Clear previous game state
            selectedWords = [];
            usedWords.clear();
            hintsUsed = 0;
            
            // Render word bank for the back of the card
            renderWordBank(currentCase.wordBank);
            updateAnswerTrail();
            
            showToast(`Carta ${caseIndex + 1} revelada! üé¥`, '#667eea');
        }

        function closeCardModal() {
            document.getElementById('card-modal').style.display = 'none';
            createTrailHouses(); // Refresh houses to show updated status
        }

        function flipCard() {
            const cardContainer = document.querySelector('.card-container');
            cardContainer.classList.toggle('flipped');
            
            if (cardContainer.classList.contains('flipped')) {
                showToast('Hora de resolver! üéØ', '#10b981');
            } else {
                showToast('Revisando a pergunta üìñ', '#3b82f6');
            }
        }





        function renderWordBank(words) {
            const wordBank = document.getElementById('word-bank');
            const shuffledWords = [...words].sort(() => Math.random() - 0.5);
            
            wordBank.innerHTML = shuffledWords.map(word => 
                `<div class="word-chip" onclick="selectWord('${word}')" data-word="${word}">
                    ${word}
                </div>`
            ).join('');
        }

        function selectWord(word) {
            if (usedWords.has(word)) return;
            
            selectedWords.push(word);
            usedWords.add(word);
            
            // Update word chip appearance
            const wordChip = document.querySelector(`[data-word="${word}"]`);
            if (wordChip) {
                wordChip.classList.add('used');
            }
            
            updateAnswerTrail();
        }

        function updateAnswerTrail() {
            const trail = document.getElementById('answer-trail');
            
            if (selectedWords.length === 0) {
                trail.innerHTML = '<div class="trail-placeholder">Clique nas frases abaixo para formar sua resposta...</div>';
                trail.classList.remove('has-words');
            } else {
                trail.classList.add('has-words');
                trail.innerHTML = selectedWords.map((word, index) => 
                    `<span class="answer-word" onclick="removeWord(${index})">${word}</span>`
                ).join('');
            }
        }

        function removeWord(index) {
            const removedWord = selectedWords[index];
            selectedWords.splice(index, 1);
            usedWords.delete(removedWord);
            
            // Update word chip appearance
            const wordChip = document.querySelector(`[data-word="${removedWord}"]`);
            if (wordChip) {
                wordChip.classList.remove('used');
            }
            
            updateAnswerTrail();
        }

        function clearTrail() {
            selectedWords = [];
            usedWords.clear();
            
            // Reset all word chips
            document.querySelectorAll('.word-chip').forEach(chip => {
                chip.classList.remove('used');
            });
            
            updateAnswerTrail();
            showToast('Trilha limpa! üóëÔ∏è', '#ef4444');
        }

        async function checkTrailAnswer() {
            if (selectedWords.length === 0) {
                showToast('Selecione algumas frases primeiro!', '#f59e0b');
                return;
            }

            if (currentRecordCount >= 999) {
                showToast('Limite de 999 respostas atingido!', '#ef4444');
                return;
            }

            const currentCase = shuffledCases[currentCaseIndex];
            const userSequence = selectedWords.join(' ');
            
            // Check if user sequence matches correct sequence
            const correctWords = currentCase.correctSequence;
            const isCorrect = checkSequenceMatch(selectedWords, correctWords);
            
            if (isCorrect) {
                streak++;
                maxStreak = Math.max(maxStreak, streak);
                
                showResultModal(true, currentCase.correctAnswer);
            } else {
                streak = 0;
                showResultModal(false, currentCase.correctAnswer);
            }

            // Save to data SDK
            const result = await window.dataSdk.create({
                case_id: currentCase.id,
                user_answer: userSequence,
                is_correct: isCorrect,
                timestamp: new Date().toISOString()
            });

            if (result.isOk) {
                updateStats();
            }
        }

        function checkSequenceMatch(userWords, correctWords) {
            // Check if user selected at least 70% of correct words in any order
            const correctSet = new Set(correctWords);
            const userCorrectWords = userWords.filter(word => correctSet.has(word));
            return userCorrectWords.length >= Math.ceil(correctWords.length * 0.7);
        }

        function showHint() {
            const currentCase = shuffledCases[currentCaseIndex];
            const correctWords = currentCase.correctSequence;
            
            // Find next correct word not yet selected
            const nextWord = correctWords.find(word => !selectedWords.includes(word));
            
            if (nextWord) {
                hintsUsed++;
                selectWord(nextWord);
                showToast(`Dica: "${nextWord}" adicionada! üí°`, '#f59e0b');
            } else {
                showToast('Todas as frases principais j√° foram selecionadas!', '#10b981');
            }
        }

        function showResultModal(isCorrect, correctAnswer) {
            const modal = document.getElementById('result-modal');
            const content = document.getElementById('result-content');
            
            if (isCorrect) {
                content.innerHTML = `
                    <div style="color: #10b981; font-size: 64px; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #10b981; margin-bottom: 16px; font-size: 28px;">Carta Conquistada!</h2>
                    <p style="margin-bottom: 16px; font-size: 18px;">Voc√™ desbloqueou o conhecimento desta carta!</p>
                    <p style="font-weight: 600; color: #059669; font-size: 16px;">üß† Sua mente absorveu mais sabedoria! ‚ú®</p>
                    <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 20px; border-radius: 12px; margin-top: 24px; text-align: left; border: 2px solid #10b981;">
                        <strong style="color: #065f46;">üí° Conhecimento Completo:</strong><br><br>
                        <div style="color: #064e3b; line-height: 1.6;">${correctAnswer}</div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div style="color: #f59e0b; font-size: 64px; margin-bottom: 20px;">ü§î</div>
                    <h2 style="color: #f59e0b; margin-bottom: 16px; font-size: 28px;">Quase l√°!</h2>
                    <p style="margin-bottom: 16px; font-size: 18px;">Esta carta ainda guarda seus segredos...</p>
                    <p style="font-weight: 600; color: #d97706; font-size: 16px;">üîç Continue explorando para desvendar o mist√©rio!</p>
                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 20px; border-radius: 12px; margin-top: 24px; text-align: left; border: 2px solid #f59e0b;">
                        <strong style="color: #92400e;">üìö Resposta Revelada:</strong><br><br>
                        <div style="color: #78350f; line-height: 1.6;">${correctAnswer}</div>
                    </div>
                `;
            }
            
            modal.style.display = 'flex';
        }

        function closeResultModal() {
            document.getElementById('result-modal').style.display = 'none';
            closeCardModal(); // Close the card and return to house grid
            showToast('Continue explorando outras cartas! üó∫Ô∏è', '#667eea');
        }

        function shuffleCards() {
            shuffledCases = [...cases].sort(() => Math.random() - 0.5);
            currentCaseIndex = 0;
            hintsUsed = 0;
            
            // Recreate the houses with new order
            createTrailHouses();
            updateStats();
            showToast('Cartas embaralhadas! Nova aventura! üîÄ', '#f59e0b');
        }

        function resetGame() {
            currentCaseIndex = 0;
            streak = 0;
            maxStreak = 0;
            hintsUsed = 0;
            shuffledCases = [...cases];
            thoughtCloudState = 'thinking';
            
            // Reset houses
            createTrailHouses();
            updateStats();
            showToast('Jornada reiniciada! Todas as cartas foram reembaralhadas! üîÑ', '#ef4444');
        }





        function showToast(message, color) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.backgroundColor = color;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Global functions
        window.shuffleCards = shuffleCards;
        window.resetGame = resetGame;
        window.selectWord = selectWord;
        window.removeWord = removeWord;
        window.clearTrail = clearTrail;
        window.checkTrailAnswer = checkTrailAnswer;
        window.showHint = showHint;
        window.closeResultModal = closeResultModal;
        window.openCard = openCard;
        window.closeCardModal = closeCardModal;
        window.flipCard = flipCard;
        window.moveCharacterToHouse = moveCharacterToHouse;

        async function onConfigChange(config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
            const fontFamily = `${customFont}, ${baseFontStack}`;

            document.getElementById('main-title').textContent = config.main_title || defaultConfig.main_title;
            document.getElementById('main-title').style.fontSize = `${baseSize * 2.25}px`;
            document.getElementById('main-title').style.fontFamily = fontFamily;

            document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
            document.getElementById('subtitle').style.fontSize = `${baseSize * 1.5}px`;
            document.getElementById('subtitle').style.fontFamily = fontFamily;



            const header = document.querySelector('header');
            header.style.background = `linear-gradient(135deg, ${config.primary_color || defaultConfig.primary_color} 0%, ${adjustColor(config.primary_color || defaultConfig.primary_color, -20)} 100%)`;

            renderTrailGame();
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.card_color || defaultConfig.card_color,
                            set: (value) => {
                                config.card_color = value;
                                window.elementSdk.setConfig({ card_color: value });
                            }
                        },
                        {
                            get: () => config.primary_color || defaultConfig.primary_color,
                            set: (value) => {
                                config.primary_color = value;
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.accent_color || defaultConfig.accent_color,
                            set: (value) => {
                                config.accent_color = value;
                                window.elementSdk.setConfig({ accent_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: {
                        get: () => config.font_family || defaultConfig.font_family,
                        set: (value) => {
                            config.font_family = value;
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    },
                    fontSizeable: {
                        get: () => config.font_size || defaultConfig.font_size,
                        set: (value) => {
                            config.font_size = value;
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["main_title", config.main_title || defaultConfig.main_title],
                    ["subtitle", config.subtitle || defaultConfig.subtitle]
                ])
            });
        }

        // Handle window resize for responsive layout
        let resizeTimeout;
        function handleResize() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                createTrailHouses();
                updateStats();
            }, 250);
        }

        // Initialize the game
        async function initializeGame() {
            await init();
            createTrailHouses();
            updateStats();
            
            // Add resize listener for responsive updates
            window.addEventListener('resize', handleResize);
            window.addEventListener('orientationchange', () => {
                setTimeout(handleResize, 500); // Delay for orientation change
            });
        }

        initializeGame();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99a9b48753a9ae1a',t:'MTc2MjQ4NTczNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
